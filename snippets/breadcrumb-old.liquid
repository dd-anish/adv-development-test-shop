{%- if settings.breadcrumb_enabled -%}
  {%- unless template == 'index' or template == '404' -%}
    {%- assign nested_collection = collection.metafields.custom.nested_collection_for_breadcrumb -%}
    <nav class="breadcrumb" role="navigation" aria-label="breadcrumbs">
      <div class="page-width">
        <a href="{{ routes.root_url }}" title="{{ 'general.breadcrumbs.home_link_title' | t }}" class="focus-inset">
          {{ 'general.breadcrumbs.home' | t -}}
        </a>
        {% assign template_name = template | split: '.' | first %}
        {%- case template_name -%}
          {%- when 'page' -%}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ page.title }}
          {%- when 'product' -%}
            {% if collection %}
              {% if nested_collection %}
                {% for collection_list in nested_collection.value %}
                  <span class="breadcrumb__divider" aria-hidden="true">/</span>
                  <a href="{{ collection_list.url }}" class="focus-inset">{{ collection_list.title }}</a>
                {% endfor %}
              {% endif %}
              <span class="breadcrumb__divider" aria-hidden="true">/</span>
              <a href="{{ collection.url }}" class="focus-inset">{{ collection.title }}</a>
            {% endif %}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ product.title }}
          {%- when 'list-collections' -%}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ 'sections.collection_list.collections' | t }}
          {%- when 'collection' and collection.handle -%}
            {% if nested_collection %}
              {% for collection_list in nested_collection.value %}
                <span class="breadcrumb__divider" aria-hidden="true">/</span>
                <a href="{{ collection_list.url }}" class="focus-inset">{{ collection_list.title }}</a>
              {% endfor %}
            {% endif %}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ collection.title }}
          {%- when 'blog' -%}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ blog.title | escape }}
          {%- when 'article' -%}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            <a href="{{ blog.url }}" class="focus-inset">{{ blog.title }}</a>
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ article.title }}
          {%- when 'cart' -%}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {{ 'sections.cart.title' | t }}
          {%- when 'search' -%}
            <span class="breadcrumb__divider" aria-hidden="true">/</span>
            {% if search.performed %}
              {{- 'templates.search.title' | t -}}
            {%- else -%}
              {{- 'general.search.search' | t -}}
            {%- endif -%}
          {%- else -%}
            {%- assign request_path = request.path -%}
            {%- for policy in shop.policies %}
              {% if request_path == policy.url %}
                <span class="breadcrumb__divider" aria-hidden="true">/</span>
                {{ policy.title }}
              {% endif %}
            {%- endfor %}
        {%- endcase -%}
      </div>
    </nav>
  {%- endunless -%}
{%- endif -%}